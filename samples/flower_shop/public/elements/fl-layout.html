<link rel="import" href="../bower_components/app-router/app-router.html"/>
<link rel="import" href="../bower_components/google-chart/google-chart.html"/>
<link rel="import" href="../bower_components/paper-dialog/paper-dialog.html"/>
<link rel="import" href="fl-dashboard.html"/>
<link rel="import" href="fl-sales-distribution.html"/>
<link rel="import" href="fl-trends.html"/>
<link rel="import" href="fl-side-nav.html"/>

<polymer-element name="fl-layout">
  <template>
    <style>
      :host {
        display: block;
        font-family: helvitica, sans-serif;
        height: 100%;
      }
      app-router {
        overflow: auto;
      }
      #layoutWrapper {
        height: 100%;
        width: 100%;
      }
      fl-side-nav {
        min-width: 200px;
        box-shadow: 0px 0px 20px 10px black;
        overflow: auto;
      }
      .reportLayout {
        min-height: 100%;
        min-width: 1000px;
      }
      .reportBackground {
        min-width: 950px;
        height: 100%;
        background-color: white;
        box-shadow: 0px 0px 20px 10px black;
      }
      .report {
        padding: 10px;
      }
      fl-dashboard {
        min-width: 800px;
      }
      fl-dashboard /deep/ google-chart {
        width: 400px;
        height: 400px;
      }
      .report /deep/ google-chart {
        width: 700px;
        height: 600px;
      }
      :host /deep/ google-chart /deep/ svg > rect {
        fill: none;
      }
      fl-report-options {
        margin: 5px;
        padding: 10px;
        border-style: solid;
        border-width: 1px;
        border-color: rgba(0, 0, 0, .3);
        border-radius: 5px;
        flex: 0 0 auto;
      }
    </style>
    <paper-dialog id="reportNameDialog" backdrop autoclosedisabled>
      <div id="reportNameDialogWrapper" layout vertical>
        <h1>Adding Report to Dashboard</h1>
        <p>(But first, lets give it a name)</p>
        <input id="reportName" value="{{reportName}}"></input>
        <div layout horizontal center-justified>
          <button on-click="{{cancelAddToDashboard}}">Cancel</button>
          <button on-click="{{confirmAddToDashboard}}" disabled?="{{reportName.length == 0}}">Ok</button>
        </div>
      </div>
    </paper-dialog>
    <div id="layoutWrapper" layout horizontal>
      <fl-side-nav on-navigate="{{navigate}}"></fl-side-nav>
      <app-router id="mainRouter" flex relative>
        <app-route path="/dashboard">
          <template>
            <fl-dashboard></fl-dashboard>
          </template>
        </app-route>
        <app-route path="/distribution">
          <template>
            <div class="reportLayout" layout vertical center>
              <div class="reportBackground">
                <fl-sales-distribution class="report">
                  <fl-report-options id="options" label="Sales Distribution" localStorageKey="salesReportData">
                    <button title="Add to Dashboard" on-click="{{addToDashboard}}"><img src="../images/dash.svg"></img></button>
                  </fl-report-options>
                </fl-sales-distribution>
              </div>
            </div>
          </template>
        </app-route>
        <app-route path="/trends">
          <template>
            <div class="reportLayout" layout vertical center>
              <div class="reportBackground">
                <fl-trends class="report">
                  <fl-report-options id="options" label="Trends" localStorageKey="trendsReportState">
                    <button title="Add to Dashboard" on-click="{{addToDashboard}}"><img src="../images/dash.svg"></img></button>
                  </fl-report-options>
                </fl-trends>
              </div>
            </div>
          </template>
        </app-route>
        <app-route path="*" redirect="/dashboard"></app-route>
      </app-router>
    </div>
  </template>
  <script>
    Polymer({
      reportNameGiven: false,
      ready: function () {
        this.reportName = "";
        this.storage = document.getElementById('storage');
      },
      navigate: function (event) {
        this.$.mainRouter.go(event.detail.route)
      },
      addToDashboard: function (event) {
        this.$.reportNameDialog.toggle();
      },
      cancelAddToDashboard: function () {
        this.reportName = '';
        this.$.reportNameDialog.toggle();
      },
      confirmAddToDashboard: function () {
        this.$.reportNameDialog.toggle();
        var dashboardViews = this.storage.getItem('dashboardViews');
        if (!dashboardViews) {
          dashboardViews = [];
        } else {
          dashboardViews = JSON.parse(dashboardViews);
        }

        dashboardViews.push({
          name: this.reportName,
          element: this.selectFromRoute('.report').nodeName.toLowerCase(),
          options: this.selectFromRoute('#options').getState()
        });

        this.reportName = '';

        this.storage.setItem('dashboardViews', JSON.stringify(dashboardViews));
      },
      selectFromRoute: function (selector) {
        return this.$.mainRouter.querySelector('app-route ' + selector);
      }
    });
  </script>
</polymer-element>
